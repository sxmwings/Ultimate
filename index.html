<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no"/>
<meta name="apple-mobile-web-app-capable" content="yes">
<title>üèÜ HYBRID MASTER 51</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
:root {
--bg-primary: #0a0e17;
--bg-card: #151a25;
--bg-card-light: #1a202e;
--accent: #F59E0B;
--accent-dark: #d97706;
--text-primary: #ffffff;
--text-secondary: #8b92a8;
--border: rgba(255,255,255,0.08);
--success: #10b981;
--danger: #ef4444;
}
* {
box-sizing: border-box;
-webkit-tap-highlight-color: transparent;
}
html {
font-size: 16px;
}
html, body {
height: 100%;
margin: 0;
padding: 0;
background: var(--bg-primary);
color: var(--text-primary);
font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
-webkit-font-smoothing: antialiased;
overflow-x: hidden;
}
body {
padding-top: env(safe-area-inset-top);
padding-bottom: env(safe-area-inset-bottom);
}
.screen {
display: none;
min-height: 100vh;
padding-bottom: 140px;
}
.screen.active {
display: block;
}
.container-mobile {
max-width: 430px;
padding: 20px;
margin: 0 auto;
}
.header-main {
text-align: center;
padding: 32px 0 40px;
}
.header-icon {
font-size: 64px;
margin-bottom: 12px;
}
.header-title {
font-size: 36px;
font-weight: 800;
background: linear-gradient(135deg, #F59E0B 0%, #fbbf24 100%);
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
margin: 12px 0;
letter-spacing: 0.5px;
}
.header-subtitle {
color: var(--text-secondary);
font-size: 16px;
}
.week-card {
background: var(--bg-card);
border-radius: 20px;
padding: 24px;
margin-bottom: 20px;
border: 1px solid var(--border);
}
.week-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 24px;
gap: 16px;
}
.week-label {
font-size: 22px;
font-weight: 700;
}
.week-block {
font-size: 15px;
color: var(--text-secondary);
margin-top: 6px;
font-weight: 500;
}
.week-nav {
display: flex;
gap: 10px;
}
.session-grid {
display: grid;
grid-template-columns: 1fr;
gap: 14px;
}
.session-btn {
background: linear-gradient(135deg, var(--accent) 0%, var(--accent-dark) 100%);
color: var(--bg-primary);
padding: 26px 22px;
border-radius: 14px;
border: none;
font-weight: 700;
font-size: 17px;
cursor: pointer;
box-shadow: 0 6px 16px rgba(245, 158, 11, 0.3);
transition: transform 0.2s;
text-align: center;
}
.session-btn:active {
transform: scale(0.97);
}
.card-dark {
background: var(--bg-card);
border-radius: 20px;
padding: 24px;
margin-bottom: 20px;
border: 1px solid var(--border);
}
.card-title {
font-size: 20px;
font-weight: 700;
margin-bottom: 18px;
}
.btn-primary {
background: var(--accent);
color: var(--bg-primary);
padding: 14px 28px;
border-radius: 12px;
border: none;
font-weight: 700;
font-size: 16px;
cursor: pointer;
transition: all 0.2s;
}
.btn-primary:active {
transform: scale(0.97);
}
.btn-nav {
background: var(--bg-card-light);
color: var(--text-primary);
padding: 14px 24px;
border-radius: 12px;
border: 1px solid var(--border);
font-weight: 600;
font-size: 16px;
cursor: pointer;
transition: all 0.2s;
}
.btn-nav:active {
transform: scale(0.97);
}
.btn-dashboard {
background: var(--bg-card-light);
color: var(--text-primary);
padding: 16px 18px;
border-radius: 12px;
border: 1px solid var(--border);
font-weight: 600;
font-size: 16px;
cursor: pointer;
flex: 1;
min-width: 110px;
transition: all 0.2s;
}
.btn-dashboard:active {
transform: scale(0.97);
}
.btn-dashboard.danger {
color: var(--danger);
border-color: rgba(239, 68, 68, 0.4);
}
.dashboard-actions {
display: flex;
gap: 12px;
flex-wrap: wrap;
}
.dashboard-msg {
color: var(--text-secondary);
font-size: 15px;
margin-bottom: 18px;
padding: 12px 14px;
background: var(--bg-card-light);
border-radius: 10px;
}
.session-header {
display: flex;
justify-content: space-between;
align-items: center;
padding: 24px 0;
position: sticky;
top: 0;
background: var(--bg-primary);
z-index: 10;
margin-bottom: 20px;
}
.btn-back {
background: var(--bg-card);
color: var(--text-primary);
padding: 14px 22px;
border-radius: 12px;
border: 1px solid var(--border);
font-weight: 600;
font-size: 16px;
cursor: pointer;
transition: all 0.2s;
}
.btn-back:active {
transform: scale(0.97);
}
.session-title {
font-size: 20px;
font-weight: 700;
color: var(--accent);
text-align: center;
flex: 1;
}
.exercise-list {
display: flex;
flex-direction: column;
gap: 18px;
padding-bottom: 60px;
}
.exercise-card {
background: var(--bg-card);
border-radius: 18px;
border: 1px solid var(--border);
overflow: hidden;
transition: border-color 0.2s;
}
.exercise-card:active {
border-color: rgba(245, 158, 11, 0.3);
}
.exercise-header {
padding: 22px;
cursor: pointer;
display: flex;
justify-content: space-between;
align-items: center;
gap: 16px;
}
.exercise-name {
font-size: 20px;
font-weight: 700;
color: var(--accent);
margin-bottom: 10px;
}
.exercise-meta {
font-size: 16px;
color: var(--text-secondary);
line-height: 1.4;
}
.exercise-arrow {
font-size: 28px;
color: var(--text-secondary);
transition: transform 0.3s ease;
flex-shrink: 0;
}
.exercise-arrow.open {
transform: rotate(180deg);
}
.exercise-details {
max-height: 0;
overflow: hidden;
transition: max-height 0.4s ease;
background: var(--bg-card-light);
}
.exercise-details.open {
max-height: 3000px;
padding: 24px;
border-top: 1px solid var(--border);
}
.technique-banner {
background: linear-gradient(135deg, rgba(245, 158, 11, 0.18) 0%, rgba(251, 191, 36, 0.18) 100%);
border: 2px solid rgba(245, 158, 11, 0.4);
color: var(--accent);
padding: 16px 20px;
border-radius: 14px;
font-weight: 700;
text-align: center;
margin-bottom: 24px;
font-size: 17px;
}
.set-row {
display: grid;
grid-template-columns: 90px 1fr 1fr 56px;
gap: 14px;
align-items: center;
margin-bottom: 14px;
padding: 18px 16px;
background: var(--bg-card);
border-radius: 14px;
border: 1px solid var(--border);
}
.set-label {
font-weight: 700;
font-size: 17px;
color: var(--text-primary);
}
.input-label {
display: block;
font-size: 11px;
font-weight: 700;
color: var(--text-secondary);
margin-bottom: 6px;
text-transform: uppercase;
letter-spacing: 0.8px;
}
.set-input {
background: var(--bg-primary);
border: 2px solid var(--border);
color: var(--text-primary);
padding: 16px 12px;
border-radius: 12px;
text-align: center;
font-size: 20px;
font-weight: 700;
width: 100%;
transition: all 0.2s;
}
.set-input:focus {
outline: none;
border-color: var(--accent);
background: rgba(245, 158, 11, 0.08);
}
.set-checkbox {
display: none;
}
.set-checkbox + label {
width: 44px;
height: 44px;
border-radius: 50%;
border: 3px solid var(--border);
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
transition: all 0.2s;
background: var(--bg-card-light);
}
.set-checkbox + label:active {
transform: scale(0.9);
}
.set-checkbox:checked + label {
background: var(--success);
border-color: var(--success);
transform: scale(1.15);
box-shadow: 0 0 20px rgba(16, 185, 129, 0.5);
}
.set-checkbox:checked + label::after {
content: '‚úì';
color: white;
font-weight: bold;
font-size: 24px;
}
.exercise-actions {
display: flex;
gap: 14px;
margin-top: 24px;
}
.btn-secondary {
background: var(--bg-card);
color: var(--text-primary);
padding: 18px 24px;
border-radius: 14px;
border: 1px solid var(--border);
font-weight: 600;
font-size: 17px;
cursor: pointer;
flex: 1;
transition: all 0.2s;
}
.btn-secondary:active {
transform: scale(0.97);
}
.btn-save {
background: var(--accent);
color: var(--bg-primary);
padding: 18px 24px;
border-radius: 14px;
border: none;
font-weight: 700;
font-size: 17px;
cursor: pointer;
flex: 1;
box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
transition: all 0.2s;
}
.btn-save:active {
transform: scale(0.97);
}
.rest-timer-fixed {
position: fixed;
bottom: -180px;
left: 50%;
transform: translateX(-50%);
background: var(--bg-card);
border-radius: 24px;
border: 2px solid var(--border);
box-shadow: 0 -12px 50px rgba(0, 0, 0, 0.7);
z-index: 1000;
transition: bottom 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
width: 94%;
max-width: 410px;
padding: 24px;
}
.rest-timer-fixed.visible {
bottom: 28px;
}
.timer-content {
display: flex;
align-items: center;
gap: 20px;
}
.timer-circle {
position: relative;
flex-shrink: 0;
}
#timerProgressCircle {
stroke-dasharray: 226;
stroke-dashoffset: 226;
transform: rotate(-90deg);
transform-origin: 50% 50%;
transition: stroke-dashoffset 1s linear;
}
.timer-text {
position: absolute;
top: 0;
left: 0;
right: 0;
bottom: 0;
display: flex;
align-items: center;
justify-content: center;
font-size: 24px;
font-weight: 700;
color: var(--accent);
}
.timer-info {
flex: 1;
}
.timer-next {
font-weight: 700;
font-size: 19px;
margin-bottom: 6px;
}
.timer-label {
font-size: 14px;
color: var(--text-secondary);
}
.timer-skip {
background: rgba(239, 68, 68, 0.25);
color: var(--danger);
border: 2px solid rgba(239, 68, 68, 0.5);
width: 52px;
height: 52px;
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
font-size: 26px;
font-weight: 700;
flex-shrink: 0;
transition: all 0.2s;
}
.timer-skip:active {
background: rgba(239, 68, 68, 0.4);
transform: scale(0.9);
}
.modal {
position: fixed;
top: 0;
left: 0;
right: 0;
bottom: 0;
z-index: 2000;
display: none;
align-items: center;
justify-content: center;
padding: 24px;
}
.modal.active {
display: flex;
}
.modal-overlay {
position: absolute;
top: 0;
left: 0;
right: 0;
bottom: 0;
background: rgba(0, 0, 0, 0.88);
backdrop-filter: blur(4px);
}
.modal-content {
position: relative;
background: var(--bg-card);
border-radius: 20px;
padding: 30px;
max-width: 390px;
width: 100%;
max-height: 80vh;
overflow-y: auto;
border: 1px solid var(--border);
}
select.set-input {
background: var(--bg-primary);
cursor: pointer;
}
input[type="number"] {
-webkit-appearance: none;
-moz-appearance: textfield;
}
input[type="number"]::-webkit-inner-spin-button,
input[type="number"]::-webkit-outer-spin-button {
-webkit-appearance: none;
margin: 0;
}
* {
-webkit-overflow-scrolling: touch;
}
.modal-content::-webkit-scrollbar {
width: 8px;
}
.modal-content::-webkit-scrollbar-track {
background: var(--bg-card-light);
border-radius: 10px;
}
.modal-content::-webkit-scrollbar-thumb {
background: var(--accent);
border-radius: 10px;
}
.modal-content::-webkit-scrollbar-thumb:hover {
background: var(--accent-dark);
}
</style>
</head>
<body>
<div id="restTimer" class="rest-timer-fixed">
<div class="timer-content">
<div class="timer-circle">
<svg width="80" height="80" viewBox="0 0 80 80">
<circle cx="40" cy="40" r="36" stroke="rgba(255,255,255,0.1)" stroke-width="6" fill="none"/>
<circle id="timerProgressCircle" cx="40" cy="40" r="36" stroke="#F59E0B" stroke-width="6" fill="none" stroke-linecap="round"/>
</svg>
<div id="timerText" class="timer-text">0:00</div>
</div>
<div class="timer-info">
<div id="nextExerciseName" class="timer-next">Repos</div>
<div class="timer-label">Temps de repos</div>
</div>
<button id="skipTimerBtn" class="timer-skip">‚úï</button>
</div>
</div>

<div id="home" class="screen active">
<div class="container-mobile">
<header class="header-main">
<div class="header-icon">üèÜ</div>
<h1 class="header-title">HYBRID MASTER 51</h1>
<p class="header-subtitle">26 semaines ‚Ä¢ 3 s√©ances/semaine</p>
</header>

<div class="week-card">
<div class="week-header">
<div>
<div class="week-label">Semaine <span id="weekDisplay">1</span></div>
<div id="blockName" class="week-block">Bloc</div>
</div>
<div class="week-nav">
<button id="prevWeek" class="btn-nav">‚Üê Pr√©c.</button>
<button id="advanceWeek" class="btn-primary">Suiv. ‚Üí</button>
</div>
</div>
<div id="progList" class="session-grid"></div>
</div>

<div class="card-dark">
<div class="card-title">Tableau de Bord</div>
<div id="quickMsg" class="dashboard-msg">Pr√™t.</div>
<div class="dashboard-actions">
<button id="openStats" class="btn-dashboard">üìä Poids</button>
<button id="exportWeights" class="btn-dashboard">üíæ Export</button>
<button id="resetApp" class="btn-dashboard danger">‚ö†Ô∏è Reset</button>
</div>
</div>
</div>
</div>

<div id="session" class="screen">
<div class="container-mobile">
<div class="session-header">
<button class="btn-back" id="backHomeBtn">‚Üê Retour</button>
<div id="sessionTitle" class="session-title">S√©ance</div>
<div style="width:80px"></div>
</div>
<div id="exerciseList" class="exercise-list"></div>
</div>
</div>

<div id="modal" class="modal">
<div class="modal-overlay"></div>
<div class="modal-content" id="modalContent"></div>
</div>

<script>
(function() {
'use strict';

const PROGRAM = {
dimanche: {
key: 'dimanche',
title: "Dimanche - Dos + Jambes Lourdes",
exercises: [
{ name: "Trap Bar Deadlift", sets: 4, reps: "6-8", rest: 150, weight: 75, type: "barre", tech: "Tempo 3-1-2" },
{ name: "Goblet Squat", sets: 3, reps: "10", rest: 90, weight: 25, type: "halt√®res", tech: "Tempo 3-1-2" },
{ name: "Lat Pulldown", sets: 3, reps: "10", rest: 90, weight: 60, type: "machine", tech: "Tempo 2-1-2" },
{ name: "Leg Press", sets: 3, reps: "12", rest: 120, weight: 110, type: "machine", tech: "Tempo 2-1-2" },
{ name: "Landmine Press", sets: 3, reps: "10", rest: 120, weight: 40, type: "barre", tech: "Standard" },
{ name: "Incline Curl", sets: 2, reps: "12", rest: 75, weight: 14, type: "halt√®res", tech: "Tempo 2-1-2" },
{ name: "Reverse Curl", sets: 2, reps: "15", rest: 75, weight: 8, type: "halt√®res", tech: "Tempo 3-1-2" }
]
},
mardi: {
key: 'mardi',
title: "Mardi - Pecs + √âpaules + Bras",
exercises: [
{ name: "Dumbbell Press", sets: 3, reps: "10", rest: 120, weight: 22, type: "halt√®res", tech: "Tempo 2-1-2" },
{ name: "Close-Grip Bench Press", sets: 3, reps: "10", rest: 90, weight: 70, type: "barre", tech: "Standard" },
{ name: "Lateral Raises", sets: 3, reps: "15", rest: 60, weight: 8, type: "halt√®res", tech: "Tempo 2-1-2" },
{ name: "Face Pull", sets: 3, reps: "15", rest: 60, weight: 20, type: "machine", tech: "Tempo 3-1-2" },
{ name: "Cable Curl", sets: 3, reps: "12", rest: 75, weight: 25, type: "machine", tech: "Standard" },
{ name: "Rope Hammer Curl", sets: 2, reps: "15", rest: 60, weight: 12, type: "machine", tech: "Standard" },
{ name: "Triceps Pushdown", sets: 2, reps: "12", rest: 60, weight: 25, type: "machine", tech: "Standard" }
]
},
vendredi: {
key: 'vendredi',
title: "Vendredi - Dos + Jambes L√©g√®res + Bras",
exercises: [
{ name: "Landmine Row", sets: 3, reps: "10", rest: 120, weight: 50, type: "barre", tech: "Tempo 2-1-2" },
{ name: "Leg Curl", sets: 3, reps: "12", rest: 90, weight: 35, type: "machine", tech: "Tempo 3-1-2" },
{ name: "Leg Extension", sets: 3, reps: "15", rest: 75, weight: 40, type: "machine", tech: "Standard" },
{ name: "Dumbbell Fly", sets: 3, reps: "12", rest: 75, weight: 12, type: "halt√®res", tech: "Tempo 3-1-2" },
{ name: "EZ Bar Curl", sets: 3, reps: "12", rest: 60, weight: 30, type: "barre", tech: "Standard" },
{ name: "Wrist Curl", sets: 3, reps: "20", rest: 45, weight: 8, type: "barre", tech: "Standard" }
]
}
};

const STATE_KEY = 'hm51_v5';
let state, currentSessionKey, timerInterval;

function defaultState() {
const weights = {};
Object.values(PROGRAM).forEach(function(s) {
s.exercises.forEach(function(e) {
weights[e.name] = e.weight;
});
});
return {
week: 1,
weights: weights,
hist: {},
program: JSON.parse(JSON.stringify(PROGRAM)),
customExercises: []
};
}

function loadState() {
try {
const raw = localStorage.getItem(STATE_KEY);
if (raw) {
const loaded = JSON.parse(raw);
if (!loaded.customExercises) loaded.customExercises = [];
return loaded;
}
} catch (e) {
console.error('Erreur localStorage:', e);
}
return defaultState();
}

function saveState() {
try {
localStorage.setItem(STATE_KEY, JSON.stringify(state));
} catch (e) {
console.error('Erreur sauvegarde:', e);
}
}

function showScreen(id) {
document.querySelectorAll(".screen").forEach(function(s) {
s.classList.remove("active");
});
const screen = document.getElementById(id);
if (screen) screen.classList.add("active");
}

function showQuickMsg(msg) {
const el = document.getElementById('quickMsg');
if (!el) return;
el.textContent = msg;
el.style.color = '#10b981';
setTimeout(function() {
el.textContent = 'Pr√™t.';
el.style.color = '';
}, 3000);
}

function getBlockInfo(week) {
if (week <= 5) return { name: 'Bloc 1 - Fondation', tech: 'Tempo contr√¥l√©' };
if (week <= 11) return { name: 'Bloc 2 - Surcharge', tech: 'Rest-Pause' };
return { name: 'Bloc 3 - Intensification', tech: 'Drop-sets + Myo-reps' };
}

function getLastPerformance(exName) {
const hist = state.hist[exName];
if (!hist || hist.length === 0) return null;
return hist[hist.length - 1];
}

function renderHeader() {
const weekDisplay = document.getElementById('weekDisplay');
const blockName = document.getElementById('blockName');
if (weekDisplay) weekDisplay.textContent = state.week;
const block = getBlockInfo(state.week);
if (blockName) blockName.textContent = block.name;
}

function renderProgramList() {
const progList = document.getElementById('progList');
if (!progList) return;
progList.innerHTML = '';
Object.values(state.program).forEach(function(s) {
const btn = document.createElement('button');
btn.className = 'session-btn';
const exCount = s.exercises.length;
const totalSets = s.exercises.reduce(function(sum, ex) { return sum + ex.sets; }, 0);
btn.innerHTML = '<div style="font-size:18px;font-weight:700;margin-bottom:8px">' + s.title + '</div>' +
'<div style="font-size:14px;opacity:0.9">' + exCount + ' exercices ‚Ä¢ ' + totalSets + ' s√©ries</div>';
btn.onclick = function() { openSession(s.key); };
progList.appendChild(btn);
});
}

window.backHome = function() {
showScreen("home");
renderHeader();
renderProgramList();
};

function openSession(key) {
currentSessionKey = key;
showScreen('session');
const sessionTitle = document.getElementById('sessionTitle');
if (sessionTitle) sessionTitle.textContent = state.program[key].title;
const list = document.getElementById('exerciseList');
if (!list) return;
list.innerHTML = '';
state.program[key].exercises.forEach(function(ex) {
const w = state.weights[ex.name] || ex.weight;
const exId = ex.name.replace(/[^a-zA-Z0-9]/g, '');
const lastPerf = getLastPerformance(ex.name);
let perfBadge = '';
if (lastPerf) {
perfBadge = '<div style="font-size:13px;color:#10b981;margin-top:4px">üìä Dernier: ' + lastPerf.weight + 'kg √ó ' + lastPerf.reps + ' reps</div>';
}
const card = document.createElement('div');
card.className = 'exercise-card';
card.innerHTML = '<div class="exercise-header" onclick="toggleExerciseDetails(\'' + exId + '\')">' +
'<div style="flex:1">' +
'<div class="exercise-name">' + ex.name + '</div>' +
'<div class="exercise-meta">' + ex.sets + ' s√©ries √ó ' + ex.reps + ' reps ‚Ä¢ ' + ex.rest + 's repos ‚Ä¢ ' + w + 'kg</div>' +
perfBadge +
'</div>' +
'<div class="exercise-arrow" id="arrow-' + exId + '">‚ñº</div>' +
'</div>' +
'<div class="exercise-details" id="details-' + exId + '"></div>';
list.appendChild(card);
});
}

window.toggleExerciseDetails = function(exId) {
const details = document.getElementById('details-' + exId);
const arrow = document.getElementById('arrow-' + exId);
if (!details || !arrow) return;
const wasOpen = details.classList.contains('open');
document.querySelectorAll('.exercise-details.open').forEach(function(d) {
if (d.id !== 'details-' + exId) {
d.classList.remove('open');
const a = document.getElementById('arrow-' + d.id.substring(8));
if (a) a.classList.remove('open');
}
});
if (!wasOpen) {
const exName = details.previousElementSibling.querySelector('.exercise-name').textContent;
const ex = state.program[currentSessionKey].exercises.find(function(e) { return e.name === exName; });
if (ex) renderExerciseDetails(ex);
details.classList.add('open');
arrow.classList.add('open');
} else {
details.innerHTML = '';
details.classList.remove('open');
arrow.classList.remove('open');
}
};

function renderExerciseDetails(ex) {
const exId = ex.name.replace(/[^a-zA-Z0-9]/g, '');
const details = document.getElementById('details-' + exId);
if (!details) return;
const w = state.weights[ex.name] || ex.weight;
const lastPerf = getLastPerformance(ex.name);
let techBanner = ex.tech;
if (state.week > 5 && state.week <= 11) {
techBanner = ex.tech + ' + Rest-Pause (derni√®re s√©rie)';
} else if (state.week > 11) {
techBanner = ex.tech + ' + Drop-sets + Myo-reps';
}

let perfMsg = '';
if (lastPerf) {
perfMsg = '<div style="background:rgba(16,185,129,0.1);border:1px solid rgba(16,185,129,0.3);color:#10b981;padding:12px 16px;border-radius:10px;margin-bottom:16px;font-size:14px;font-weight:600">' +
'üìä Derni√®re fois : ' + lastPerf.weight + 'kg √ó ' + lastPerf.reps +
' reps (Semaine ' + lastPerf.week + ')' +
'</div>';
} else {
perfMsg = '<div style="background:rgba(245,158,11,0.1);border:1px solid rgba(245,158,11,0.3);color:var(--accent);padding:12px 16px;border-radius:10px;margin-bottom:16px;font-size:14px;font-weight:600">' +
'‚≠ê Premi√®re fois pour cet exercice !' +
'</div>';
}

let setsHtml = '';
for (let i = 1; i <= ex.sets; i++) {
setsHtml += '<div class="set-row">' +
'<div class="set-label">S√©rie ' + i + '</div>' +
'<div>' +
'<label class="input-label">KG</label>' +
'<input type="number" value="' + w + '" class="set-input w-' + exId + '-' + i + '" step="0.5" placeholder="Poids">' +
'</div>' +
'<div>' +
'<label class="input-label">REPS</label>' +
'<input type="number" value="' + ex.reps + '" class="set-input r-' + exId + '-' + i + '" placeholder="Reps">' +
'</div>' +
'<div>' +
'<input type="checkbox" id="s-' + i + '-' + exId + '" class="set-checkbox">' +
'<label for="s-' + i + '-' + exId + '"></label>' +
'</div>' +
'</div>';
}

details.innerHTML = '<div class="technique-banner">‚ú® ' + techBanner + '</div>' +
perfMsg +
setsHtml +
'<div class="exercise-actions">' +
'<button class="btn-secondary" onclick="modifyWeight(\'' + ex.name + '\')">‚úèÔ∏è Modifier Poids</button>' +
'<button class="btn-save" onclick="savePerf(\'' + ex.name + '\')">üíæ Enregistrer & Valider</button>' +
'</div>';

document.querySelectorAll('#details-' + exId + ' .set-checkbox').forEach(function(cb, idx) {
cb.addEventListener('change', function() {
if (this.checked) {
const isLast = idx === ex.sets - 1;
const nextText = isLast ? "Prochain exercice" : "Repos";
startTimer(ex.rest, nextText);
}
});
});
}

function startTimer(duration, next) {
clearInterval(timerInterval);
const timer = document.getElementById('restTimer');
const text = document.getElementById('timerText');
const circle = document.getElementById('timerProgressCircle');
const nextExerciseName = document.getElementById('nextExerciseName');
if (!timer || !text || !circle || !nextExerciseName) return;
nextExerciseName.textContent = next;
timer.classList.add('visible');
let left = duration;
const circ = 226;
const update = function() {
const minutes = Math.floor(left/60);
const seconds = (left%60).toString().padStart(2,'0');
text.textContent = minutes + ':' + seconds;
circle.style.strokeDashoffset = circ - (left/duration)*circ;
if (left <= 0) {
clearInterval(timerInterval);
timer.classList.remove('visible');
if (navigator.vibrate) {
navigator.vibrate([400, 200, 400, 200, 400]);
}
playBeep();
} else {
left--;
}
};
update();
timerInterval = setInterval(update, 1000);
}

function playBeep() {
try {
const audioContext = new (window.AudioContext || window.webkitAudioContext)();
const oscillator = audioContext.createOscillator();
const gainNode = audioContext.createGain();
oscillator.connect(gainNode);
gainNode.connect(audioContext.destination);
oscillator.frequency.value = 800;
oscillator.type = 'sine';
gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
oscillator.start(audioContext.currentTime);
oscillator.stop(audioContext.currentTime + 0.5);
} catch(e) {
console.log('Audio non support√©');
}
}

const skipTimerBtn = document.getElementById('skipTimerBtn');
if (skipTimerBtn) {
skipTimerBtn.addEventListener('click', function() {
clearInterval(timerInterval);
const timer = document.getElementById('restTimer');
if (timer) timer.classList.remove('visible');
});
}

window.modifyWeight = function(exName) {
const w = state.weights[exName];
openModal('<h3 style="font-weight:700;font-size:20px;margin-bottom:16px;color:var(--accent)">‚úèÔ∏è Modifier le poids</h3>' +
'<div style="text-align:center;margin-bottom:16px;color:var(--text-secondary);font-size:16px">' + exName + '</div>' +
'<input type="number" id="newW" class="set-input" value="' + w + '" step="0.5" style="width:100%;font-size:24px;margin-bottom:20px;padding:18px"/>' +
'<div style="display:flex;gap:12px">' +
'<button class="btn-save" onclick="saveWeight(\'' + exName + '\')" style="flex:1;padding:16px">üíæ Enregistrer</button>' +
'<button class="btn-secondary" onclick="closeModal()" style="flex:1;padding:16px">‚ùå Annuler</button>' +
'</div>');
setTimeout(function() {
const input = document.getElementById('newW');
if (input) {
input.focus();
input.select();
}
}, 100);
};

window.saveWeight = function(exName) {
const newWInput = document.getElementById('newW');
if (!newWInput) return;
const nw = parseFloat(newWInput.value);
if (!isNaN(nw) && nw >= 0) {
const oldWeight = state.weights[exName];
state.weights[exName] = nw;
saveState();
showQuickMsg('‚úì ' + exName + ': ' + oldWeight + 'kg ‚Üí ' + nw + 'kg');
closeModal();
setTimeout(function() { openSession(currentSessionKey); }, 300);
} else {
showQuickMsg('‚ö†Ô∏è Poids invalide');
}
};

window.savePerf = function(exName) {
const exId = exName.replace(/[^a-zA-Z0-9]/g, '');
const ex = state.program[currentSessionKey].exercises.find(function(e) { return e.name === exName; });
if (!ex) return;
let sets = [];
for (let i = 1; i <= ex.sets; i++) {
const wInput = document.querySelector('.w-' + exId + '-' + i);
const rInput = document.querySelector('.r-' + exId + '-' + i);
if (!wInput || !rInput) continue;
const w = parseFloat(wInput.value) || 0;
const r = parseInt(rInput.value) || 0;
if (r > 0) sets.push({ w: w, r: r });
}
if (sets.length === 0) {
return showQuickMsg("‚ö†Ô∏è Entrez au moins une r√©p√©tition");
}
const best = sets.reduce(function(a,b) { return b.r > a.r ? b : a; });
if (!state.hist[exName]) state.hist[exName] = [];
state.hist[exName].push({
week: state.week,
weight: best.w,
reps: best.r,
ts: Date.now(),
allSets: sets
});
state.weights[exName] = best.w;
saveState();
showQuickMsg('‚úÖ ' + exName + ': ' + sets.length + ' s√©rie(s) ‚Ä¢ ' + best.r + ' reps @ ' + best.w + 'kg');
};

function openModal(html) {
const modal = document.getElementById('modal');
const modalContent = document.getElementById('modalContent');
if (!modal || !modalContent) return;
modal.classList.add('active');
modalContent.innerHTML = html;
}

window.closeModal = function() {
const modal = document.getElementById('modal');
const modalContent = document.getElementById('modalContent');
if (!modal || !modalContent) return;
modal.classList.remove('active');
modalContent.innerHTML = '';
};

window.createCustomExercise = function() {
openModal('<h3 style="font-weight:700;font-size:20px;margin-bottom:20px;color:var(--accent)">‚ûï Nouvel Exercice</h3>' +
'<div style="display:flex;flex-direction:column;gap:16px">' +
'<div>' +
'<label class="input-label">Nom de l\'exercice</label>' +
'<input type="text" id="customExName" class="set-input" placeholder="Ex: Squat Bulgare" style="width:100%;padding:14px"/>' +
'</div>' +
'<div>' +
'<label class="input-label">Type</label>' +
'<select id="customExType" class="set-input" style="width:100%;padding:14px">' +
'<option value="halt√®res">Halt√®res</option>' +
'<option value="barre">Barre</option>' +
'<option value="machine">Machine</option>' +
'<option value="poids du corps">Poids du corps</option>' +
'</select>' +
'</div>' +
'<div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">' +
'<div>' +
'<label class="input-label">S√©ries</label>' +
'<input type="number" id="customExSets" class="set-input" value="3" min="1" style="width:100%;padding:14px"/>' +
'</div>' +
'<div>' +
'<label class="input-label">Reps</label>' +
'<input type="text" id="customExReps" class="set-input" value="10" placeholder="Ex: 8-12" style="width:100%;padding:14px"/>' +
'</div>' +
'</div>' +
'<div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">' +
'<div>' +
'<label class="input-label">Repos (sec)</label>' +
'<input type="number" id="customExRest" class="set-input" value="90" min="0" style="width:100%;padding:14px"/>' +
'</div>' +
'<div>' +
'<label class="input-label">Poids (kg)</label>' +
'<input type="number" id="customExWeight" class="set-input" value="20" step="0.5" min="0" style="width:100%;padding:14px"/>' +
'</div>' +
'</div>' +
'</div>' +
'<div style="display:flex;gap:12px;margin-top:24px">' +
'<button class="btn-save" onclick="saveCustomExercise()" style="flex:1;padding:16px">üíæ Cr√©er</button>' +
'<button class="btn-secondary" onclick="closeModal()" style="flex:1;padding:16px">‚ùå Annuler</button>' +
'</div>');
};

window.saveCustomExercise = function() {
const nameInput = document.getElementById('customExName');
const typeInput = document.getElementById('customExType');
const setsInput = document.getElementById('customExSets');
const repsInput = document.getElementById('customExReps');
const restInput = document.getElementById('customExRest');
const weightInput = document.getElementById('customExWeight');
if (!nameInput || !typeInput || !setsInput || !repsInput || !restInput || !weightInput) return;
const name = nameInput.value.trim();
const type = typeInput.value;
const sets = parseInt(setsInput.value);
const reps = repsInput.value.trim();
const rest = parseInt(restInput.value);
const weight = parseFloat(weightInput.value);
if (!name) {
alert('‚ö†Ô∏è Nom requis');
return;
}
const newEx = {
name: name,
type: type,
sets: sets,
reps: reps,
rest: rest,
weight: weight,
tech: 'Standard',
custom: true
};
state.customExercises.push(newEx);
state.weights[name] = weight;
saveState();
showQuickMsg('‚úÖ Exercice "' + name + '" cr√©√© !');
closeModal();
};

window.viewCustomExercises = function() {
let html = '<h3 style="font-weight:700;margin-bottom:20px;color:var(--accent);font-size:20px">üí™ Mes Exercices</h3>';
if (state.customExercises.length === 0) {
html += '<div style="text-align:center;color:var(--text-secondary);padding:20px">Aucun exercice personnalis√©</div>';
} else {
html += '<div style="display:flex;flex-direction:column;gap:10px">';
state.customExercises.forEach(function(ex) {
html += '<div style="padding:14px;background:var(--bg-card-light);border-radius:10px;border:1px solid var(--border)">' +
'<div style="font-weight:700;margin-bottom:4px">' + ex.name + '</div>' +
'<div style="font-size:13px;color:var(--text-secondary)">' + ex.sets + '√ó' + ex.reps + ' ‚Ä¢ ' + ex.rest + 's ‚Ä¢ ' + ex.weight + 'kg ‚Ä¢ ' + ex.type + '</div>' +
'</div>';
});
html += '</div>';
}
html += '<button class="btn-save" onclick="createCustomExercise()" style="margin-top:20px;width:100%;padding:16px">‚ûï Nouvel Exercice</button>';
html += '<button class="btn-secondary" onclick="closeModal()" style="margin-top:12px;width:100%;padding:16px">Fermer</button>';
openModal(html);
};

const openStatsBtn = document.getElementById('openStats');
if (openStatsBtn) {
openStatsBtn.addEventListener('click', function() {
let h = '<h3 style="font-weight:700;margin-bottom:20px;color:var(--accent);font-size:20px">üìä Poids Actuels</h3><div style="display:flex;flex-direction:column;gap:10px">';
Object.entries(state.weights).forEach(function(entry) {
const n = entry[0];
const w = entry[1];
h += '<div style="display:flex;justify-content:space-between;padding:14px;background:var(--bg-card-light);border-radius:10px;border:1px solid var(--border);font-size:15px"><span>' + n + '</span><strong style="color:var(--accent)">' + w + 'kg</strong></div>';
});
h += '</div>';
h += '<button class="btn-secondary" onclick="viewCustomExercises()" style="margin-top:16px;width:100%;padding:16px">üí™ Mes Exercices</button>';
h += '<button class="btn-save" onclick="closeModal()" style="margin-top:12px;width:100%;padding:16px">Fermer</button>';
openModal(h);
});
}

const exportWeightsBtn = document.getElementById('exportWeights');
if (exportWeightsBtn) {
exportWeightsBtn.addEventListener('click', function() {
let csv = 'Exercise,Week,Set,Reps,Weight(kg),Date\n';
Object.entries(state.hist).forEach(function(entry) {
const exName = entry[0];
const records = entry[1];
records.forEach(function(r) {
const date = new Date(r.ts).toLocaleDateString('fr-FR');
if (r.allSets && r.allSets.length > 0) {
r.allSets.forEach(function(set, idx) {
csv += '"' + exName + '",' + r.week + ',' + (idx + 1) + ',' + set.r + ',' + set.w + ',' + date + '\n';
});
} else {
csv += '"' + exName + '",' + r.week + ',1,' + r.reps + ',' + r.weight + ',' + date + '\n';
}
});
});
const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
const a = document.createElement('a');
a.href = URL.createObjectURL(blob);
const dateStr = new Date().toISOString().split('T')[0];
a.download = 'hybrid_master_51_COMPLET_' + dateStr + '.csv';
a.click();
showQuickMsg('‚úì Export complet r√©ussi !');
});
}

const resetAppBtn = document.getElementById('resetApp');
if (resetAppBtn) {
resetAppBtn.addEventListener('click', function() {
if (confirm('‚ö†Ô∏è R√©initialiser toutes les donn√©es ? Cette action est irr√©versible.')) {
try {
localStorage.removeItem(STATE_KEY);
location.reload();
} catch(e) {
console.error('Erreur reset:', e);
}
}
});
}

const advanceWeekBtn = document.getElementById('advanceWeek');
if (advanceWeekBtn) {
advanceWeekBtn.addEventListener('click', function() {
if (state.week < 26) {
state.week++;
saveState();
renderHeader();
showQuickMsg('‚úì Semaine ' + state.week);
} else {
showQuickMsg('üéâ Programme termin√© !');
}
});
}

const prevWeekBtn = document.getElementById('prevWeek');
if (prevWeekBtn) {
prevWeekBtn.addEventListener('click', function() {
if (state.week > 1) {
state.week--;
saveState();
renderHeader();
showQuickMsg('‚úì Semaine ' + state.week);
}
});
}

const backHomeBtn = document.getElementById('backHomeBtn');
if (backHomeBtn) {
backHomeBtn.addEventListener('click', window.backHome);
}

const modalOverlay = document.querySelector('.modal-overlay');
if (modalOverlay) {
modalOverlay.addEventListener('click', window.closeModal);
}

state = loadState();
renderHeader();
renderProgramList();
})();
</script>
</body>
</html>
